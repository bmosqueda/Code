<!DOCTYPE html>
<html>
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
	</style>
	<title>SNAKE GAME</title>
</head>
<body>
	<div class="container" style="text-align: center; padding-top: 25px;">
		<button type="button" class="btn btn-success" onclick="startGame()">Iniciar el juego</button>
		<br>
		<h4>Dificultad</h4>
		<br>
		<form>
		    <label class="radio-inline">
		        <input id="easy" type="radio" name="optradio">Fácil
		    </label>
		    <label class="radio-inline">
		        <input id="medium" type="radio" name="optradio" checked>Medio
		    </label>
		    <label class="radio-inline">
		        <input id="hard" type="radio" name="optradio">Difícil
		    </label>
		</form>
	</div>
	<br>
	<br>
	<div class="container" id="board" style="text-align: center;" hidden>
		<pre id="demo"></pre>
		<br>
		<br>
		<b id="lose" style="color: red; text-align: center;" hidden>Perdiste</b>
	</div>
	<script type="text/javascript">
		const demo = document.getElementById("demo");
		const lose = document.getElementById("lose");

		var fourth;
		var third;
		var second;
		var snake;
		var change;
		var meal;
		var goAhead;
		/*
				0
			3		1
				2
		*/
		//0 vacìo, 1 serpiente, 2 comida
		const row = 10;
		const colum = 10;

		var board = new Array(row);
		for (var i = 0; i <= row; i++)
			board[i] = new Array(colum);

		function clearBoard()
		{
			for (var i = 0; i <= row; i++)
				for (var j = 0; j <= colum; j++)
					board[i][j] = ".";
		}

		function getRandomMeal()
		{
			meal = false;
			var rowRan;
			var columRan;
			do {
				rowRan = Math.floor(Math.random() * (row + 1));
				columRan = Math.floor(Math.random() * (colum + 1));
			} while(board[rowRan][columRan] != ".");

			board[rowRan][columRan] = "W";
		}

		function changeOrientation(orientation)
		{
			switch(snake.orientation)
			{
				case 0:
					if(orientation != 2 && change)
						snake.orientation = orientation;
					break;
				case 1:
					if(orientation != 3 && change)
						snake.orientation = orientation;
					break;
				case 2:
					if(orientation != 0 && change)
						snake.orientation = orientation;
					break;
				case 3:
					if(orientation != 1 && change)
						snake.orientation = orientation;
					break;
			}
			change = false;
		}

		function advanceSnake()
		{
			var temp = snake.next;
			var rowTemp = snake.row;
			var columTemp = snake.colum;
			while(temp != null)
			{
				var rt = temp.row;
				var ct = temp.colum;
				temp.row = rowTemp;
				temp.colum = columTemp;

				rowTemp = rt;
				columTemp = ct;
				temp = temp.next;
			}
			change = true;
			board[rowTemp][columTemp] = ".";
		}

		function snakeToBoard()
		{
			var temp = snake.next;
			board[snake.row][snake.colum] = "X";

			while(temp != null)
			{
				board[temp.row][temp.colum] = "x";
				temp = temp.next;
			}
		}

		function printBoard()
		{
			snakeToBoard();
			if(meal)
				getRandomMeal();
			demo.innerHTML = "";
			for (var i = 0; i <= row; i++)
			{
				for (var j = 0; j <= colum; j++)
				{
					if(board[i][j] == ".")
						demo.innerHTML += board[i][j];
					else if(board[i][j] == "X" || board[i][j] == "x")
						demo.innerHTML += '<b style="color:green;">' + board[i][j] + "</b>";
					else
						demo.innerHTML += '<b style="color:red;">' + board[i][j] + "</b>";

					demo.innerHTML += "  ";
				}
				demo.innerHTML += "<br>";
			}
		}

		document.addEventListener('keydown', function(ev) {
			if(ev.keyCode == 38)
				changeOrientation(0);
			else if(ev.keyCode == 39)
				changeOrientation(1);
			else if(ev.keyCode == 40)
				changeOrientation(2);
			else if(ev.keyCode == 37)
				changeOrientation(3);
		});

		function move()
		{
			var rs = snake.row, cs = snake.colum;
			switch(snake.orientation) {
				case 0:
					--rs;
					if(rs < 0)
					{
						lose.removeAttribute("hidden");
						clearInterval(goAhead);
						return 0;
					}
					break;
				case 1:
					++cs;
					if(cs > colum)
					{
						lose.removeAttribute("hidden");
						clearInterval(goAhead);
						return 0;
					}
					break;
				case 2:
					++rs;
					if(rs > row)
					{
						lose.removeAttribute("hidden");
						clearInterval(goAhead);
						return 0;
					}
					break;
				case 3:
					--cs;
					if(cs < 0)
					{
						lose.removeAttribute("hidden");
						clearInterval(goAhead);
						return 0;
					}
					break;
			}

			if(board[rs][cs] == ".") {
				advanceSnake();
				snake.row = rs;
				snake.colum = cs;
			}
			else if(board[rs][cs] == "W")
			{
				meal = true;
				newPoint = {row: rs, colum: cs, orientation: snake.orientation, next: snake};
				snake = newPoint;
			}
			else
			{
				lose.removeAttribute("hidden");
				clearInterval(goAhead);
				return 0;
			}

			printBoard();
		}

		function startGame()
		{
			document.getElementById("board").removeAttribute("hidden");
			lose.setAttribute("hidden", true);
			var velocity = 250;
			if(document.getElementById("easy").checked)
				velocity = 350;
			else if(document.getElementById("hard").checked)
				velocity = 150;

			fourth = {row: 5, colum: 2, next: null}
			third = {row: 5, colum: 3, next: fourth}
			second = {row: 5, colum: 4, next: third}
			snake = {row: 5, colum: 5, orientation: 1, next: second}
			change = true;
			meal = false;

			clearBoard();
			board[5][10] = "W";
			printBoard();

			goAhead = setInterval(move, velocity);
		}
	</script>
</body>
</html>